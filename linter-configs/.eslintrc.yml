# yamllint disable rule:truthy
#───────────────────────────────────────────────────────────────────────────────
extends: [eslint:recommended]
root: true # stop annoying deprecation warning
ignorePatterns: ["!.*", "node_modules"] # Lint files in dotfolder https://github.com/eslint/eslint/issues/10341#issuecomment-468548031
parserOptions:
  ecmaVersion: 2022 # requires at least 2022 so eslint can parse `await` at top level
  sourceType: module
env:
  node: false
  browser: false

reportUnusedDisableDirectives: true

#───────────────────────────────────────────────────────────────────────────────
# JAVASCRIPT-SPECIFIC

globals:
  # JXA
  ObjC: readonly
  delay: readonly
  Application: readonly
  $: readonly
  Set: readonly
  Path: readonly
  console: readonly

  # Obsidian
  tp: readonly # templater
  request: readonly

rules:
  no-unused-vars:
    - warn
    - varsIgnorePattern: run # jxa in Alfred
  no-unused-expressions: off # not useful for JXA due to direct return

  #─────────────────────────────────────────────────────────────────────────────
  # SHARED WITH TYPESCRIPT

  # Structure / Blocks
  complexity: [warn, 15]
  max-depth: [warn, 4]
  no-empty:
    - warn
    - allowEmptyCatch: true

  # variables
  no-implicit-coercion: warn
  id-length:
    - warn
    - min: 4
      max: 25
      properties: never
      exceptions: [x, y, i, j, id, min, max, app, str, int, out, a, b, num, url, run, tag, ext, cmd, key]
  no-underscore-dangle: warn
  no-shadow:
    - warn
    - hoist: all
  camelcase:
    - warn
    - properties: always
      ignoreImports: true
  no-var: warn
  prefer-const: warn
  sort-vars: warn
  no-use-before-define: warn
  no-multi-assign: error
  no-sequences: error
  no-undefined: error
  one-var-declaration-per-line:
    - warn
    - initializations
  no-lone-blocks: error

  # Async & Await
  no-await-in-loop: error
  require-atomic-updates: error
  # require-await: error # TODO figure out why this triggers in Obsidian onload function

  # Functions
  no-empty-function: warn
  array-callback-return:
    - error
    - checkForEach: false
      allowImplicit: true
  no-confusing-arrow: warn
  no-useless-return: warn
  consistent-return: warn
  func-names: warn
  func-style:
    - warn
    - declaration
    - allowArrowFunctions: true

  # Parenthesis
  no-extra-parens:
    - warn
    - all
    - returnAssign: false

  # Loops
  no-unmodified-loop-condition: warn
  no-unreachable-loop: error

  # Comments
  spaced-comment:
    - warn
    - always
    - exceptions: ["-", "_", "─"]

  # Semicolon
  no-extra-semi: warn
  semi-style:
    - warn
    - last

  # Commas
  comma-spacing: warn
  comma-style: warn
  quotes:
    - warn
    - double
    - avoidEscape: true
      allowTemplateLiterals: true

  # Imports & eval
  no-duplicate-imports: error
  sort-imports: warn
  dot-notation: error
  no-eval: error
  no-implied-eval: error

  # Strings & Regex
  no-template-curly-in-string: error
  no-useless-concat: warn
  no-multi-str: error
  prefer-regex-literals:
    - warn
    - disallowRedundantWrapping: true

  # Numbers
  no-magic-numbers:
    - warn
    # prettier-ignore
    - ignore: [-10, -9, -8, -7, -6, -5, -4, -3, -2, -1, 0, 0.1, 0.2, 0.5, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 20, 100, 1000, 10000]
      ignoreArrayIndexes: true
      ignoreDefaultValues: true
  no-floating-decimal: warn

  # Arrays
  prefer-spread: warn
  prefer-object-spread: warn

  # Conditions
  default-case: error # switch/case
  default-case-last: warn
  eqeqeq: error
  no-self-compare: error
  no-eq-null: warn
  no-negated-condition: error
  no-unneeded-ternary: warn
  no-nested-ternary: error
  no-constant-binary-expression: error
  yoda: warn
  no-else-return:
    - warn
    - allowElseIf: true
  no-lonely-if: warn
  no-mixed-operators: error
