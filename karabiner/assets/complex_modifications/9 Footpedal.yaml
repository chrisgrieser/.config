rules:
  - description: "Footpedal"
    manipulators:
      - type: basic
        from: { key_code: f3 }
        to:
          - shell_command: |
              osascript -e '
                tell application "Spotify"
                  if it is frontmost then
                    tell application "System Events" to tell process "Spotify" to set visible to false
                  else
                    activate
                  end if
                end tell'
      # Like (only feature still working with Spotify-TUI)
      - type: basic
        from: { key_code: f4 }
        to:
          - shell_command: |
              export PATH=/usr/local/lib:/usr/local/bin:/opt/homebrew/bin/:$PATH
              spt playback --like | sed 's/üîÄ//' | sed 's/‚ñ∂Ô∏è//' |
              xargs -I {} osascript -e 'display notification "{}" with title "üéµ Spotify"'
      # Back
      - type: basic
        from: { key_code: f7 }
        to:
          - shell_command: |
              i=0
              while ! pgrep "Spotify"; do
                open -a "Spotify"
                sleep 0.2
                i=$((i + 1))
                [[ $i -gt 15 ]] && exit 1
              done
              osascript -e 'tell application "Spotify" to previous track'
      # Play/Pause
      - type: basic
        from: { key_code: f8 }
        to:
          - shell_command: |
              i=0
              while ! pgrep "Spotify"; do
                open -a "Spotify"
                sleep 0.2
                i=$((i + 1))
                [[ $i -gt 15 ]] && exit 1
              done
              osascript -e 'tell application "Spotify" to playpause'
      # Forward
      - type: basic
        from: { key_code: f9 }
        to:
          - shell_command: |
              i=0
              while ! pgrep "Spotify"; do
                open -a "Spotify"
                sleep 0.2
                i=$((i + 1))
                [[ $i -gt 15 ]] && exit 1
              done
              osascript -e 'tell application "Spotify" to next track'
