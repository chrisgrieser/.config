# yaml-language-server: $schema=./schema/karabiner-mod-schema.json
# vim: foldlevel=2
title: App-specific bindings
anchors:
  - &leftSidebar { key_code: "1", modifiers: { mandatory: [command] } }
  - &rightSidebar { key_code: "0", modifiers: { mandatory: [command] } }
  - &export { key_code: e, modifiers: { mandatory: [command, shift] } }
  - &revealInFinder { key_code: l, modifiers: { mandatory: [command] } }
rules:
  #─────────────────────────────────────────────────────────────────────────────
  - description: "Toggle LEFT sidebar"
    manipulators:
      # Microsoft Word
      - type: basic
        from: *leftSidebar
        to:
          - shell_command: |
              osascript -e '
                tell application "System Events" to tell process "Microsoft Word"
                  click menu item "Thumbnail" of menu of menu item "Sidebar" of menu "View" of menu bar 1
                end tell'
        conditions: [{ type: frontmost_application_if, bundle_identifiers: [com.microsoft.Word] }]
      # Safari
      - type: basic
        from: *leftSidebar
        to:
          - { key_code: l, modifiers: [shift, command] }
        conditions: [{ type: frontmost_application_if, bundle_identifiers: [com.apple.Safari] }]
      # Finder
      - type: basic
        from: *leftSidebar
        to:
          - { key_code: s, modifiers: [control, command] }
        conditions: [{ type: frontmost_application_if, bundle_identifiers: [com.apple.finder] }]
      # Calendar
      - type: basic
        from: *leftSidebar
        to:
          # needs UI element, since name of the menu items changes
          # howto inspect UI-elements https://www.sudoade.com/gui-scripting-with-applescript/
          - shell_command: |
              osascript -e '
                tell application "System Events" to tell process "Calendar"
                  click radio button 1 of radio group 1 of group 1 of toolbar 1 of window 1
                end tell'
        conditions: [{ type: frontmost_application_if, bundle_identifiers: [com.apple.iCal] }]
      # Maps
      - type: basic
        from: *leftSidebar
        to:
          - { key_code: s, modifiers: [command, option] }
        conditions:
          - { type: frontmost_application_if, bundle_identifiers: [com.apple.Maps] }
      # Monodraw
      - type: basic
        from: *leftSidebar
        to:
          - { key_code: semicolon, modifiers: [command, shift] }
        conditions:
          - { type: frontmost_application_if, bundle_identifiers: [com.helftone.monodraw] }
      # PDF Expert
      - type: basic
        from: *leftSidebar
        to:
          - { key_code: "0", modifiers: [command, option] }
        conditions:
          - { type: frontmost_application_if, bundle_identifiers: [com.readdle.PDFExpert-Mac] }
  #─────────────────────────────────────────────────────────────────────────────
  - description: "Toggle RIGHT sidebar"
    manipulators:
      # Highlights
      - type: basic
        from: *rightSidebar
        to:
          - { key_code: "2", modifiers: [command] }
        conditions:
          - { type: frontmost_application_if, bundle_identifiers: [net.highlightsapp.universal] }
      # Finder
      - type: basic
        from: *rightSidebar
        to:
          - { key_code: p, modifiers: [shift, command] }
        conditions: [{ type: frontmost_application_if, bundle_identifiers: [com.apple.finder] }]
      # Brave
      - type: basic
        from: *rightSidebar
        to:
          - { key_code: "0", modifiers: [option] }
        conditions:
          - { type: frontmost_application_if, bundle_identifiers: [com.brave.Browser] }
      # Zoom
      - type: basic
        from: *rightSidebar
        to:
          - { key_code: h, modifiers: [command, shift] }
        conditions: [{ type: frontmost_application_if, bundle_identifiers: [us.zoom.xos] }]
      # Monodraw
      - type: basic
        from: *rightSidebar
        to:
          - { key_code: quote, modifiers: [command, shift] }
        conditions:
          - { type: frontmost_application_if, bundle_identifiers: [com.helftone.monodraw] }
  #─────────────────────────────────────────────────────────────────────────────
  - description: "Export"
    manipulators:
      # Microsoft Word
      - type: basic
        from: *export
        to:
          - shell_command: |
              osascript -e '
                tell application "System Events" to tell process "Microsoft Word"
                  click menu item "Save As..." of menu "File" of menu bar 1
                end tell'
        conditions:
          - { type: frontmost_application_if, bundle_identifiers: [com.microsoft.Word] }
      # Microsoft Excel
      - type: basic
        from: *export
        to:
          - shell_command: |
              osascript -e '
                tell application "System Events" to tell process "Microsoft Excel"
                  click menu item "Save As..." of menu "File" of menu bar 1
                  set formatSelection to (pop up button 2 of sheet 1 of window 1)
                  click formatSelection
                  click menu item "PDF " of menu 1 of (formatSelection) # SIC trailing space typo from Excel
                end tell'
        conditions:
          - { type: frontmost_application_if, bundle_identifiers: [com.microsoft.Excel] }
      # Preview
      - type: basic
        from: *export
        to:
          - shell_command: |
              osascript -e '
                tell application "System Events" to tell (first process where it is frontmost)
                  click menu item "Export…" of menu "File" of menu bar 1
                end tell'
        conditions:
          - { type: frontmost_application_if, bundle_identifiers: [com.apple.Preview] }
      # TextEdit
      - type: basic
        from: *export
        to:
          - shell_command: |
              osascript -e '
                tell application "System Events" to tell (first process where it is frontmost)
                  click menu item "Export as PDF…" of menu "File" of menu bar 1
                end tell'
        conditions:
          - { type: frontmost_application_if, bundle_identifiers: [com.apple.TextEdit] }
      # Brave Browser
      - type: basic
        from: *export
        to:
          - { key_code: p, modifiers: [command] }
        conditions:
          - { type: frontmost_application_if, bundle_identifiers: [com.brave.Browser] }
      # Monodraw
      - type: basic
        from: *export
        to:
          - { key_code: a, modifiers: [command] }
          - { key_code: c, modifiers: [command] }
          - { key_code: escape }
          - shell_command:
              osascript -e 'display notification "Exported to clipboard" with title "Monodraw"'
        conditions:
          - { type: frontmost_application_if, bundle_identifiers: [com.helftone.monodraw] }
  #─────────────────────────────────────────────────────────────────────────────
  - description: "Reveal in Finder"
    manipulators:
      # TextEdit, Preview
      - type: basic
        from: *revealInFinder
        to:
          - shell_command: |
              front_app=$(osascript -e 'tell application "System Events" to get name of first process whose frontmost is true')
              file_path=$(osascript -e "tell application \"$front_app\" to get path of document 1")
              open -R "$file_path"
        conditions:
          - type: frontmost_application_if
            bundle_identifiers: [com.apple.TextEdit, com.apple.Preview]
      # PDF Expert
      - type: basic
        from: *revealInFinder
        to:
          - shell_command: |
              osascript -e '
                tell application "System Events" to tell (first process where it is frontmost)
                  click menu item "Show in Finder" of menu "File" of menu bar 1
                end tell'
        conditions:
          - { type: frontmost_application_if, bundle_identifiers: [com.readdle.PDFExpert-Mac] }
      # Word
      - type: basic
        from: *revealInFinder
        to:
          - shell_command: |
              osascript -e '
                tell application "Microsoft Word"
                  set docName to name of active document
                  set parentPath to path of active document
                  set absPath to (parentPath & ":" & docName)
                end tell
                tell application "Finder"
                  reveal reveal absPath
                  activate
                end tell
              '
        conditions:
          - { type: frontmost_application_if, bundle_identifiers: [com.microsoft.Word] }
      # Highlights
      - type: basic
        from: *revealInFinder
        to:
          # only 60%, since usually slightly to the left
          - software_function: { set_mouse_cursor_position: { x: 60%, y: 1%, screen: 0 } }
          - pointing_button: button2
          - key_code: down_arrow
          - key_code: return_or_enter
        conditions:
          - type: frontmost_application_if
            bundle_identifiers: [net.highlightsapp.universal, com.helftone.monodraw]
