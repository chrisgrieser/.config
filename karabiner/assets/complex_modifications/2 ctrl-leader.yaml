title: "\U0001F53A CTRL Leader"
anchors:
  - conditions:
      - &leader-active
        type: variable_if
        name: LEADER_ACTIVE
        value: true
      - &leader-inactive
        type: variable_unless
        name: LEADER_ACTIVE
        value: true
        # IDs can be seen in the karabiner main app (devices tab)
      - &not-apple-keyboard
        type: device_unless
        identifiers:
          - vendor_id: 76 # = Apple
            is_keyboard: true
      - &is-apple-keyboard
        type: device_if
        identifiers:
          - vendor_id: 76
            is_keyboard: true
  - to:
      - &deactivate-leader
        set_variable:
          name: LEADER_ACTIVE
          value: false
      - &activate-leader
        set_variable:
          name: LEADER_ACTIVE
          value: true
      - &remove-notice
        set_notification_message:
          id: leader-notice
          text: ""
      - &set-notice
        set_notification_message:
          id: leader-notice
          text: "\U0001F53A Leader"
#───────────────────────────────────────────────────────────────────────────────
rules:
  - description: "\U0001F53A L-Ctrl (Non-Apple) / fn (Apple)"
    manipulators:
      # non-apple keyboard
      - type: basic
        from: { key_code: left_control }
        to:
          - key_code: left_control
        parameters:
          basic.to_if_alone_timeout_milliseconds: 600
        conditions:
          - *leader-inactive
          - *not-apple-keyboard
        to_if_alone:
          - key_code: left_control
          - *activate-leader
          - *set-notice
      - description: "2x Leader: F19"
        type: basic
        from: { key_code: left_control }
        to:
          - key_code: left_control
        conditions:
          - *leader-active
          - *not-apple-keyboard
          # Prevent footpedal from accidentally triggering twice.
          - type: device_if
            identifiers:
              - is_pointing_device: false
        to_if_alone:
          - key_code: f19
          - *deactivate-leader
          - *remove-notice
      # Apple Keyboard
      - type: basic
        description: Apple Keyboard
        from: { key_code: fn }
        to:
          - key_code: fn
        conditions:
          - *leader-inactive
          - *is-apple-keyboard
        parameters:
          basic.to_if_alone_timeout_milliseconds: 600
        to_if_alone:
          - key_code: fn
          - *activate-leader
          - *set-notice
      - description: "2x Leader: F19"
        type: basic
        from: { key_code: fn }
        to:
          - key_code: fn
        conditions:
          - *leader-active
          - *not-apple-keyboard
        to_if_alone:
          - key_code: f19
          - *deactivate-leader
          - *remove-notice
  #─────────────────────────────────────────────────────────────────────────────
  - description: "App Switcher Actions"
    manipulators:
      # Cancel (Esc/Hyper)
      - type: basic
        description: "Hyper (Esc): Leader Cancel"
        from: { key_code: caps_lock }
        conditions: [*leader-active]
        to_if_alone:
          - *deactivate-leader
          - *remove-notice
      # [C]alendar: BusyCal
      - type: basic
        from: { key_code: c }
        conditions: [*leader-active]
        to:
          - shell_command: open -a 'BusyCal'
          - *deactivate-leader
          - *remove-notice
      # [ö] (looks like tweetbot): twitter
      - type: basic
        from: { key_code: semicolon } # ö on German keyboard
        conditions:
          - type: variable_if
            name: LEADER_ACTIVE
            value: true
          - type: input_source_if
            input_sources: [{ language: ^de$ }]
        to:
          - shell_command: open -a 'Twitter'
          - *deactivate-leader
          - *remove-notice
      # [,]: System Preferences
      - type: basic
        from: { key_code: comma }
        conditions: [*leader-active]
        to:
          - shell_command: open -a 'System Preferences'
          - *deactivate-leader
          - *remove-notice
      # [O]bsidian
      - type: basic
        from: { key_code: o }
        conditions: [*leader-active]
        to:
          - shell_command: open -a 'Obsidian'
          - *deactivate-leader
          - *remove-notice
      # [D]iscord
      - type: basic
        from: { key_code: d }
        conditions: [*leader-active]
        to:
          - shell_command: open -a 'Discord'
          - *deactivate-leader
          - *remove-notice
      # [Z]oom
      - type: basic
        # switched y and z due to German Keyboard
        from: { key_code: "y" }
        conditions: [*leader-active]
        to:
          - shell_command: open -a 'zoom.us'
          - *deactivate-leader
          - *remove-notice
      # [E]ditor: Neovide
      - type: basic
        from: { key_code: e }
        conditions: [*leader-active]
        to:
          - shell_command: osascript -e 'tell application "Neovide" to activate'
          - *deactivate-leader
          - *remove-notice
      # [j]: Drafts (mnemonic: Jot down)
      - type: basic
        from: { key_code: j }
        conditions: [*leader-active]
        to:
          - shell_command: open -a 'Drafts'
          - *deactivate-leader
          - *remove-notice
      # [S]lack
      - type: basic
        from: { key_code: s }
        conditions: [*leader-active]
        to:
          - shell_command: open -a 'Slack'
          - *deactivate-leader
          - *remove-notice
      # Script Editor [Q]
      - type: basic
        from: { key_code: q }
        conditions: [*leader-active]
        to:
          - shell_command: open -a 'Script Editor'
          - *deactivate-leader
          - *remove-notice
      # [M]imestream
      - type: basic
        from: { key_code: m }
        conditions: [*leader-active]
        to:
          - shell_command: open -a 'Mimestream'
          - *deactivate-leader
          - *remove-notice
      # [b]rowser
      - type: basic
        from: { key_code: b }
        conditions: [*leader-active]
        to:
          - shell_command: open -a 'Vivaldi'
          - *deactivate-leader
          - *remove-notice
      # [B]rowser: re-open tab (Shift)
      - type: basic
        from: { key_code: b, modifiers: { mandatory: [shift] } }
        conditions: [*leader-active]
        to:
          - shell_command: osascript -e 'tell application "Vivaldi" to activate'
          - { key_code: vk_none, hold_down_milliseconds: 250 }
          - key_code: t
            modifiers: [command, shift]
          - *deactivate-leader
          - *remove-notice
      # [L]: Finder (mnemonic: File [L]ocation)
      - type: basic
        from: { key_code: l }
        conditions: [*leader-active]
        to:
          - shell_command: open -a "Finder"
          - *deactivate-leader
          - *remove-notice
      # [H]ammerspoon
      - type: basic
        from: { key_code: h }
        conditions: [*leader-active]
        to:
          - shell_command: open -a 'Hammerspoon'
          - *deactivate-leader
          - *remove-notice
      # [k]arabiner-EventViewer
      - type: basic
        from: { key_code: k }
        conditions: [*leader-active]
        to:
          - shell_command: open -a 'Karabiner-EventViewer'
          - *deactivate-leader
          - *remove-notice
      # [K]arabiner-Elements
      - type: basic
        from: { key_code: k, modifiers: { mandatory: [shift] } }
        conditions: [*leader-active]
        to:
          - shell_command: open -a 'Karabiner-Elements'
          - *deactivate-leader
          - *remove-notice
      # [Y]ouTube
      - type: basic
        from: { key_code: z } # switched y and z due to German Keyboard
        conditions: [*leader-active]
        to:
          - shell_command: open -a 'YouTube' || open 'https://www.youtube.com/'
          - *deactivate-leader
          - *remove-notice
      # [A]lfred Preferences
      - type: basic
        from: { key_code: a }
        conditions: [*leader-active]
        to:
          - shell_command: open -a 'Alfred Preferences'
          - *deactivate-leader
          - *remove-notice
      # [N]ews Reader: NetNewsWire/Inoreader
      - type: basic
        from: { key_code: "n" }
        conditions: [*leader-active]
        to:
          - shell_command: open -a 'lire' || open 'https://www.inoreader.com/'
          - *deactivate-leader
          - *remove-notice
      # [P]DF Reader: Highlights
      - type: basic
        from: { key_code: p }
        conditions: [*leader-active]
        to:
          - shell_command: open -a 'Highlights'
          - *deactivate-leader
          - *remove-notice
      # [G]oogle Docs
      - type: basic
        from: { key_code: g }
        conditions: [*leader-active]
        to:
          - shell_command: open -a 'Docs' || open 'https://docs.google.com/'
          - *deactivate-leader
          - *remove-notice
      # [V]ideo: IINA
      - type: basic
        from: { key_code: v }
        conditions: [*leader-active]
        to:
          - shell_command: open -a 'IINA'
          - *deactivate-leader
          - *remove-notice
      # [W]hatsApp
      - type: basic
        from: { key_code: w }
        conditions: [*leader-active]
        to:
          - shell_command: open 'https://web.whatsapp.com/'
          - *deactivate-leader
          - *remove-notice
      # [T]elegram
      - type: basic
        from: { key_code: t }
        conditions: [*leader-active]
        to:
          - shell_command: open 'https://web.telegram.org/z/'
          - *deactivate-leader
          - *remove-notice
      # [F]acebook
      - type: basic
        from: { key_code: f }
        conditions: [*leader-active]
        to:
          - shell_command: open 'https://www.messenger.com/'
          - *deactivate-leader
          - *remove-notice
      # [R]eddit: neovim/vim
      - type: basic
        from: { key_code: r }
        conditions: [*leader-active]
        to:
          - shell_command: |
              osascript -e '
                tell application "Vivaldi"
                  if (count of window) > 0 then
                    set theURL to the URL of active tab of front window
                  else
                    set theURL to ""
                  end if
                  if the theURL contains "reddit.com/r/neovim" then
                    set the URL of active tab of front window to "https://www.reddit.com/r/vim/"
                  else
                    open location "https://www.reddit.com/r/neovim/"
                  end if
                  activate
                end tell'
          - *deactivate-leader
          - *remove-notice
      # [?] (w/o shift, German keyboard) man page
      - type: basic
        from: { key_code: hyphen }
        conditions:
          - type: variable_if
            name: LEADER_ACTIVE
            value: true
          - type: input_source_if
            input_sources: [{ language: ^de$ }]
        to:
          - shell_command: open -g 'hammerspoon://focus-help'
          - *deactivate-leader
          - *remove-notice
      # [esc]: System Monitor (btop)
      - type: basic
        from: { key_code: escape }
        conditions: [*leader-active]
        to:
          - shell_command: open -g 'hammerspoon://focus-btop'
          - *deactivate-leader
          - *remove-notice
