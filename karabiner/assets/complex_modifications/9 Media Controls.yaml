rules:
  - description: "F keys to media controls"
    # see also spotify-tui issue https://github.com/Rigellute/spotify-tui/issues/1072
    # done here to be able to quickly change it back, also using applescript
    # avoids the needs for media-key forwarding
    manipulators:
      # Open Spotify
      - type: basic
        from: { key_code: f3 }
        to:
          - shell_command: open -a "Spotify"
      # Like (only feature still working with Spotify-TUI)
      - type: basic
        from: { key_code: f4 }
        to:
          - shell_command: |
              export PATH=/usr/local/lib:/usr/local/bin:/opt/homebrew/bin/:$PATH
              spt playback --like | sed 's/üîÄ//' | sed 's/‚ñ∂Ô∏è//' |
              xargs -I {} osascript -e 'display notification "{}" with title "üéµ Spotify"'
      # Back
      - type: basic
        from: { key_code: f7 }
        to:
          - shell_command: |
              i=0
              while ! pgrep "Spotify"; do
                open -a "Spotify"
                sleep 0.2
                i=$((i + 1))
                [[ $i -gt 30 ]] && exit 1
              done
              osascript -e 'tell application "Spotify" to previous track'
      # Play/Pause
      - type: basic
        from: { key_code: f8 }
        to:
          - shell_command: |
              i=0
              while ! pgrep "Spotify"; do
                open -a "Spotify"
                sleep 0.2
                i=$((i + 1))
                [[ $i -gt 30 ]] && exit 1
              done
              osascript -e 'tell application "Spotify" to playpause'
      # Forward
      - type: basic
        from: { key_code: f9 }
        to:
          - shell_command: |
              i=0
              while ! pgrep "Spotify"; do
                open -a "Spotify"
                sleep 0.2
                i=$((i + 1))
                [[ $i -gt 30 ]] && exit 1
              done
              osascript -e 'tell application "Spotify" to next track'
