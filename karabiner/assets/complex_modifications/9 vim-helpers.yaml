# yaml-language-server: $schema=./schema/karabiner-mod-schema.json
title: vim helpers
rules:
  - description: "Neovide Helpers"
    manipulators:
      # "Neovide: ⇪R to restart, ⌘Q to Quit"
      # INFO explicitly remapping cmd+q ensures that cursor position and changes are saved. 
      - type: basic
        from: { key_code: q, modifiers: { mandatory: [command] } }
        to:
          - shell_command: |
              export PATH=/usr/local/lib:/usr/local/bin:/opt/homebrew/bin/:$PATH
              if ! nvim --server "/tmp/nvim_server.pipe" --remote-send "<cmd>try|wqall|catch|qall|endtry<CR>" ; then
                osascript -e 'display notification "" with title "⚔️ Force killing nvim…"'
                killall -9 nvim neovide
              fi
        conditions:
          - { type: frontmost_application_if, file_paths: ["[Nn]eovide"] }
      # ⇪2: Hard restart
      - type: basic
        from: { key_code: "2", modifiers: { mandatory: [command, shift, control, option] } }
        to:
          - shell_command: |
              killall -9 neovide nvim language_server_macos_arm language_server_macos_x86 osascript
              osascript -e 'display notification "" with title "⚔️ Killed nvim & neovide processes."'
              sleep 0.7
              osascript -e 'tell application "Neovide" to activate' # "open -a" does not focus Neovide
        conditions:
          - { type: frontmost_application_if, file_paths: ["[Nn]eovide"] }
      #─────────────────────────────────────────────────────────────────────────────
      # HACK svim-apps: <S-Space> to f2
      - type: basic
        from: { key_code: spacebar, modifiers: { mandatory: [shift] } }
        to:
          - { key_code: s, modifiers: [control] }
        conditions:
          - type: frontmost_application_if
            bundle_identifiers:
              - ^com\.brave\.Browser$
              - ^com\.vivaldi\.Vivaldi$
              - ^com\.tinyspeck\.slackmacgap$
              - ^com\.hnc\.Discord$
              - ^com\.apptorium\.SideNotes-paddle$
              - ^com\.mimestream\.Mimestream$
