# yaml-language-server: $schema=./schema/karabiner-mod-schema.json
#â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
title: Spotify Control
rules:
  - description: Spotify Media Controls
    manipulators:
      - type: basic
        from: { key_code: f3 }
        to:
          - shell_command: |
              open "https://open.spotify.com/"

      - type: basic
        from: { key_code: f4 }
        to:
          - shell_command: |
              export PATH=/usr/local/lib:/usr/local/bin:/opt/homebrew/bin/:$PATH
              info=$(spotify_player get key playback)
              artist=$(echo $info | yq ".item.artists[0].name")
              song=$(echo $info | yq ".item.name")
              "$HOME/.config/karabiner/assets/notificators/spotify-notificator" \
                  --title "Spotify" --message "ðŸ’š $artist â€“ $song"
              spotify_player like

      - type: basic
        from: { key_code: f7 }
        to:
          - shell_command: |
              export PATH=/usr/local/lib:/usr/local/bin:/opt/homebrew/bin/:$PATH
              spotify_player playback previous

      - type: basic
        from: { key_code: f8 }
        to:
          - shell_command: |
              export PATH=/usr/local/lib:/usr/local/bin:/opt/homebrew/bin/:$PATH
              spotify_player playback play-pause

              if [[ $? -ne 0 ]]; then
                if scutil --get ComputerName | grep -q "Office"; then
                  if ! pgrep -qx spotifyd; then
                    spotifyd
                    sleep 0.5 # ensure spotifyd is running
                  fi
                  spotify_player connect --name "spotifyd"
                fi
                spotify_player playback play
              fi

              # enable "repeat all"
              repeat_state=$(spotify_player get key playback | yq ".repeat_state")
              [[ $repeat_state == "off" ]] && spotify_player playback repeat
              [[ $repeat_state == "track" ]] && spotify_player playback repeat
      - type: basic
        from: { key_code: f9 }
        to:
          - shell_command: |
              export PATH=/usr/local/lib:/usr/local/bin:/opt/homebrew/bin/:$PATH
              spotify_player playback next

              if [[ $? -ne 0 ]]; then
                if scutil --get ComputerName | grep -q "Office"; then
                  if ! pgrep -qx spotifyd; then
                    spotifyd
                    sleep 0.2 # ensure spotifyd is running
                  fi
                  spotify_player connect --name "spotifyd"
                fi
                spotify_player playback play
              fi
