# yaml-language-server: $schema=https://raw.githubusercontent.com/mattn/efm-langserver/master/schema.json
# DOCS https://github.com/mattn/efm-langserver#example-for-configyaml
# DOCS https://github.com/mattn/efm-langserver/blob/master/schema.md
#───────────────────────────────────────────────────────────────────────────────

root-markers:
  - ".git/"
  - "node_modules/"
  - ".venv/"

tools:
  shellcheck: &shellcheck
    lint-source: shellcheck
    lint-command: >-
      shellcheck --format=gcc --external-sources --shell=bash -
    lint-stdin: true
    require-marker: false
    lint-formats:
      - "-:%l:%c: %trror: %m [SC%n]"
      - "-:%l:%c: %tarning: %m [SC%n]"
      - "-:%l:%c: %tote: %m [SC%n]"
      - '%f:%l:%c: %trror: %m'
      - '%f:%l:%c: %tarning: %m'
      - '%f:%l:%c: %tote: %m'

  markdownlint: &markdownlint
    lint-source: markdownlint
    # 1. these rules are not disabled in the config, so they work for formatting
    # 2. `>-` needed, otherwise won't work
    lint-command: >-
      markdownlint --stdin --config="$HOME/.config/+ linter-configs/markdownlint.yaml"
      --disable=no-trailing-spaces --disable=no-multiple-blanks --disable=blanks-around-fences
    # `.markdownlintignore` does not work with stdin, but without stdin, lints aren't live
    lint-stdin: true
    lint-severity: 2 # 2 = warning
    lint-formats:
      - "stdin:%l %m" # needed, otherwise some rules are not reported
      - "stdin:%l:%c %m"
      - "%f:%l %m"
      - "%f:%l:%c %m"
      - "%f: %l: %m"

  actionlint: &actionlint
    lint-source: actionlint
    # conditional ensures that issue templates are not linted
    lint-command: >-
      [[ ${INPUT} =~ ".github/workflows/" ]] && actionlint -no-color -oneline -stdin-filename ${INPUT} -
    lint-stdin: true
    lint-formats:
      # actionlint integrates shellcheck, which are the first three
      - "%f:%l:%c: %.%#: SC%n:%trror:%m"
      - "%f:%l:%c: %.%#: SC%n:%tarning:%m"
      - "%f:%l:%c: %.%#: SC%n:%tnfo:%m"
      - "%f:%l:%c: %m"
    require-marker: true
    root-markers: [".github/"]

#───────────────────────────────────────────────────────────────────────────────

languages:
  zsh:
    - <<: *shellcheck
  sh:
    - <<: *shellcheck
  markdown:
    - <<: *markdownlint
  yaml:
    - <<: *actionlint
