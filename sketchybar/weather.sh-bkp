#!/usr/bin/env zsh
# USING WTTR.IN
#â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

weather=$(curl -sL "https://wttr.in/Berlin?format=1")
temperature=$(echo "$weather" | cut -c2- | tr -d "+C ")

# replace emoji with nerdfont icons
icon=$(
	echo "$weather" | cut -d" " -f1 |
		sed 's/ğŸŒ§/îŒ”/' |
		sed 's/â˜ï¸/îŒ’/' |
		sed 's/ğŸŒ«/îŒ“/' |
		sed 's/â„ï¸/ï‹œ/' |
		sed 's/ğŸŒ¦/îŒ†/' |
		sed 's/ğŸŒ¨/îŒ™/' |
		sed 's/â›…ï¸/îˆ/' |
		sed 's/â˜€ï¸/îŒ/' |
		sed 's/ğŸŒ©/ó°–“/' |
		sed 's/â›ˆ/îŒœ/'
)

if [[ "$weather" =~ Unknown ]] || [[ "$weather" =~ Sorry ]] || [[ -z "$weather" ]]; then
	icon=""
	temperature="â€“"
fi

sketchybar --set "$NAME" icon="$icon" label="$temperature"
