#!/usr/bin/env zsh

# CONFIG
nerd_font="JetBrainsMonoNL NF:Regular:16"
system_font="Lucida Grande:Regular:16.5"
stats_freq_s=3

# switch colors depending on dark mode
if defaults read -g AppleInterfaceStyle | grep -q "Dark"; then
	bg="0xff333333"
	fg="0xffffffff"
	graph_fill="0xffdddddd"
	##
else
	bg="0xffcdcdcd"
	fg="0xff000000"
	graph_fill="0xff333333"
fi

# HACK using popup for second row. The popup.{item} only refers to {item} to
# anchor to it. Should be the leftmost item of the first row.
first_row="left"
second_row="popup.clock"

#───────────────────────────────────────────────────────────────────────────────
# SKETCHYBAR CALL

# PERF one call to speed up loading https://felixkratz.github.io/SketchyBar/config/tricks#batching-of-configuration-commands
sketchybar \
	--bar \
	height=60 position="top" display="all" \
	padding_left=0 margin=-5 color="$bg" \
	\
	--default \
	drawing=false background.padding_right=10 label.padding_right=2 \
	icon.font="$nerd_font" icon.color="$fg" icon.padding_right=3 \
	label.font="$system_font" label.color="$fg" \
	\
	popup.drawing=true popup.horizontal=true popup.topmost=false \
	popup.y_offset="-35" y_offset="18" popup.padding_left=20 \
	\
	`#─────────────────────────────────────────────────────────────────────────` \
	\
	--add item clock $first_row \
	--set clock update_freq=1 drawing=true padding_left=10 \
	script="./clock.sh" \
	\
	--add item weather $first_row \
	--set weather update_freq=1200 icon.y_offset=-1 \
	script="./weather.sh" \
	\
	--add item input_source $first_row \
	--set input_source update_freq=2 \
	script="./input_source_icon.sh" \
	\
	--add item github_notif $first_row \
	--set github_notif update_freq=300 icon="" \
	script="./github_notification_count.sh" \
	--subscribe github_notif front_app_switched system_woke \
	\
	--add item reminders_count $first_row \
	--set reminders_count update_freq=300 icon="" \
	script="./reminders-count.sh" \
	--add event update_reminder_count \
	--subscribe reminders_count update_reminder_count system_woke front_app_switched \
	\
	`#─────────────────────────────────────────────────────────────────────────` \
	\
	--add graph cpu_graph $second_row 45 \
	--set cpu_graph background.height=18 \
	padding_left=12 update_freq="$stats_freq_s" drawing=true \
	background.color=$bg graph.color=$fg graph.fill_color=$graph_fill \
	script="./cpu.sh" \
	\
	--add item ram $second_row \
	--set ram update_freq="$stats_freq_s" \
	icon.font="${nerd_font/[0-9]*/21}" label.padding_right=0 \
	script="./ram.sh" \
	\
	--add item network-download $second_row \
	--set network-download icon="" update_freq="$stats_freq_s" \
	script="./network-download.sh" \
	\
	--add item network-upload $second_row \
	--set network-upload icon="" update_freq="$stats_freq_s" \
	script="./network-upload.sh" \
	\
	--add item sync-indicator $second_row \
	--set sync-indicator update_freq=180 icon="󰓦" \
	script="./git-sync-bar-icon.sh" \
	--add event repo-files-update \
	--subscribe sync-indicator system_woke repo-files-update \
	\
	--add item package-updates $second_row \
	--set package-updates update_freq=86400 icon="" \
	script="./homebrew-update-tracker.sh" \
	\
	`#─────────────────────────────────────────────────────────────────────────` \
	--update # needs to run at the end of config and should not be run in an item script
