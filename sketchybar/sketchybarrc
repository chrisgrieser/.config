#!/usr/bin/env zsh

# CONFIG
nerd_font="JetBrainsMonoNL NF:Regular:16"
system_font="Lucida Grande:Regular:16.5"

# switch colors depending on dark mode
if defaults read -g AppleInterfaceStyle &> /dev/null; then
	bg="0xff333333" # `0x` for hex, `ff` for alpha (= no transparency), `333333` as RGB
	fg="0xffffffff"
else
	bg="0xffcdcdcd"
	fg="0xff000000"
fi

# HACK using `popup` to create a 2nd row. `popup.{item}` only refers to `{item}`
# to use it as anchor, which simply should be the leftmost item of the 1st row.
row_1="left"
row_2="popup.clock"

#───────────────────────────────────────────────────────────────────────────────
# BUG since macOS Tahoe, `drawing` should not be called in initial call
# also, updates to `drawing` should not be done to quickly in a row
# https://github.com/FelixKratz/SketchyBar/issues/787
#───────────────────────────────────────────────────────────────────────────────

# PERF one call to speed up loading https://felixkratz.github.io/SketchyBar/config/tricks#batching-of-configuration-commands
sketchybar \
	`#--global-----------------------------------------------------------------`\
	--bar \
	height="75" position="top" display="all" \
	padding_left="0" margin="-4" color="$bg" \
	\
	--default \
	icon.padding_right="3" label.padding_right="3" background.padding_right="10" \
	icon.font="$nerd_font" icon.color="$fg" label.font="$system_font" label.color="$fg" \
	\
	popup.drawing="true" popup.horizontal="true" popup.topmost="false" \
	popup.y_offset="-48" y_offset="22" \
	\
	`#--1st-row----------------------------------------------------------------`\
	\
	--add item clock $row_1 \
	--set clock update_freq="1" padding_left="10" padding_right="12" \
	script="./components/clock.sh" \
	\
	--add item weather $row_1 \
	--set weather update_freq="1200" icon.y_offset="-1" \
	script="./components/weather.sh" \
	\
	--add item reminders_count $row_1 \
	--set reminders_count update_freq="300" \
	script="./components/reminders_count.sh" \
	--add event update_reminder_count --subscribe reminders_count update_reminder_count \
	--subscribe reminders_count system_woke front_app_switched \
	\
	--add item github_notif $row_1 \
	--set github_notif update_freq="300" \
	script="./components/github_notification_count.sh" \
	click_script="open 'https://github.com/notifications'" \
	--add event update_github_notif --subscribe github_notif update_github_notif \
	--subscribe github_notif system_woke front_app_switched \
	\
	`#--2nd-row----------------------------------------------------------------`\
	\
	--add item ram $row_2 \
	--set ram padding_left="14" update_freq="5" \
	icon.font="${nerd_font/[0-9]*/20.5}" label.padding_right="0" icon.padding_right="0" \
	script="./components/ram.sh" \
	\
	--add graph cpu_graph $row_2 30 \
	--set cpu_graph update_freq="3" \
	background.height="18" background.color="$bg" graph.color="0x00000000" \
	script="./components/cpu.sh" \
	\
	--add item network_download $row_2 \
	--set network_download update_freq="4" \
	script="./components/network_download.sh" \
	\
	--add item sync_indicator $row_2 \
	--set sync_indicator update_freq="180" \
	script="./components/git_sync_bar_icon.sh" \
	--add event repo_files_update \
	--subscribe sync_indicator system_woke repo_files_update \
	\
	`#-------------------------------------------------------------------------`\
	--update # needs to run at the end of config and should not be run in an item script
