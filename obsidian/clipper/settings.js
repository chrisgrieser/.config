/*! For license information please see settings.js.LICENSE.txt */
var e={992:(e,t,n)=>{var o,r=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={};function r(e,t){if(!o[e]){o[e]={};for(var n=0;n<e.length;n++)o[e][e.charAt(n)]=n}return o[e][t]}var a={compressToBase64:function(e){if(null==e)return"";var n=a._compress(e,6,(function(e){return t.charAt(e)}));switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:a._decompress(e.length,32,(function(n){return r(t,e.charAt(n))}))},compressToUTF16:function(t){return null==t?"":a._compress(t,15,(function(t){return e(t+32)}))+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:a._decompress(e.length,16384,(function(t){return e.charCodeAt(t)-32}))},compressToUint8Array:function(e){for(var t=a.compress(e),n=new Uint8Array(2*t.length),o=0,r=t.length;o<r;o++){var i=t.charCodeAt(o);n[2*o]=i>>>8,n[2*o+1]=i%256}return n},decompressFromUint8Array:function(t){if(null==t)return a.decompress(t);for(var n=new Array(t.length/2),o=0,r=n.length;o<r;o++)n[o]=256*t[2*o]+t[2*o+1];var i=[];return n.forEach((function(t){i.push(e(t))})),a.decompress(i.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":a._compress(e,6,(function(e){return n.charAt(e)}))},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),a._decompress(e.length,32,(function(t){return r(n,e.charAt(t))})))},compress:function(t){return a._compress(t,16,(function(t){return e(t)}))},_compress:function(e,t,n){if(null==e)return"";var o,r,a,i={},s={},c="",l="",d="",u=2,p=3,m=2,v=[],f=0,h=0;for(a=0;a<e.length;a+=1)if(c=e.charAt(a),Object.prototype.hasOwnProperty.call(i,c)||(i[c]=p++,s[c]=!0),l=d+c,Object.prototype.hasOwnProperty.call(i,l))d=l;else{if(Object.prototype.hasOwnProperty.call(s,d)){if(d.charCodeAt(0)<256){for(o=0;o<m;o++)f<<=1,h==t-1?(h=0,v.push(n(f)),f=0):h++;for(r=d.charCodeAt(0),o=0;o<8;o++)f=f<<1|1&r,h==t-1?(h=0,v.push(n(f)),f=0):h++,r>>=1}else{for(r=1,o=0;o<m;o++)f=f<<1|r,h==t-1?(h=0,v.push(n(f)),f=0):h++,r=0;for(r=d.charCodeAt(0),o=0;o<16;o++)f=f<<1|1&r,h==t-1?(h=0,v.push(n(f)),f=0):h++,r>>=1}0==--u&&(u=Math.pow(2,m),m++),delete s[d]}else for(r=i[d],o=0;o<m;o++)f=f<<1|1&r,h==t-1?(h=0,v.push(n(f)),f=0):h++,r>>=1;0==--u&&(u=Math.pow(2,m),m++),i[l]=p++,d=String(c)}if(""!==d){if(Object.prototype.hasOwnProperty.call(s,d)){if(d.charCodeAt(0)<256){for(o=0;o<m;o++)f<<=1,h==t-1?(h=0,v.push(n(f)),f=0):h++;for(r=d.charCodeAt(0),o=0;o<8;o++)f=f<<1|1&r,h==t-1?(h=0,v.push(n(f)),f=0):h++,r>>=1}else{for(r=1,o=0;o<m;o++)f=f<<1|r,h==t-1?(h=0,v.push(n(f)),f=0):h++,r=0;for(r=d.charCodeAt(0),o=0;o<16;o++)f=f<<1|1&r,h==t-1?(h=0,v.push(n(f)),f=0):h++,r>>=1}0==--u&&(u=Math.pow(2,m),m++),delete s[d]}else for(r=i[d],o=0;o<m;o++)f=f<<1|1&r,h==t-1?(h=0,v.push(n(f)),f=0):h++,r>>=1;0==--u&&(u=Math.pow(2,m),m++)}for(r=2,o=0;o<m;o++)f=f<<1|1&r,h==t-1?(h=0,v.push(n(f)),f=0):h++,r>>=1;for(;;){if(f<<=1,h==t-1){v.push(n(f));break}h++}return v.join("")},decompress:function(e){return null==e?"":""==e?null:a._decompress(e.length,32768,(function(t){return e.charCodeAt(t)}))},_decompress:function(t,n,o){var r,a,i,s,c,l,d,u=[],p=4,m=4,v=3,f="",h=[],g={val:o(0),position:n,index:1};for(r=0;r<3;r+=1)u[r]=r;for(i=0,c=Math.pow(2,2),l=1;l!=c;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=o(g.index++)),i|=(s>0?1:0)*l,l<<=1;switch(i){case 0:for(i=0,c=Math.pow(2,8),l=1;l!=c;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=o(g.index++)),i|=(s>0?1:0)*l,l<<=1;d=e(i);break;case 1:for(i=0,c=Math.pow(2,16),l=1;l!=c;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=o(g.index++)),i|=(s>0?1:0)*l,l<<=1;d=e(i);break;case 2:return""}for(u[3]=d,a=d,h.push(d);;){if(g.index>t)return"";for(i=0,c=Math.pow(2,v),l=1;l!=c;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=o(g.index++)),i|=(s>0?1:0)*l,l<<=1;switch(d=i){case 0:for(i=0,c=Math.pow(2,8),l=1;l!=c;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=o(g.index++)),i|=(s>0?1:0)*l,l<<=1;u[m++]=e(i),d=m-1,p--;break;case 1:for(i=0,c=Math.pow(2,16),l=1;l!=c;)s=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=o(g.index++)),i|=(s>0?1:0)*l,l<<=1;u[m++]=e(i),d=m-1,p--;break;case 2:return h.join("")}if(0==p&&(p=Math.pow(2,v),v++),u[d])f=u[d];else{if(d!==m)return null;f=a+a.charAt(0)}h.push(f),u[m++]=a+f.charAt(0),a=f,0==--p&&(p=Math.pow(2,v),v++)}}};return a}();void 0===(o=function(){return r}.call(t,n,t,e))||(e.exports=o)}},t={},n=function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}(992),o=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{c(o.next(e))}catch(e){a(e)}}function s(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((o=o.apply(e,t||[])).next())}))};let r=[],a=-1;const i="template_",s="template_list",c=8e3,l=6e3;function d(e){a=e}function u(e){return o(this,void 0,void 0,(function*(){return new Promise((t=>{chrome.storage.sync.get(i+e,(o=>{const r=o[i+e];if(r){const e=(0,n.decompressFromUTF16)(r.join(""));t(JSON.parse(e))}else t(null)}))}))}))}function p(){return new Promise(((e,t)=>o(this,void 0,void 0,(function*(){try{const n=r.map((e=>e.id)),o=[],a={};for(const e of r){const[t,n]=yield m(e);a[i+e.id]=t,n&&o.push(n)}chrome.storage.sync.set(Object.assign(Object.assign({},a),{[s]:n}),(()=>{chrome.runtime.lastError?(console.error("Error saving templates:",chrome.runtime.lastError),t(chrome.runtime.lastError)):(console.log("Template settings saved"),e(o))}))}catch(e){console.error("Error preparing templates for save:",e),t(e)}}))))}function m(e){return o(this,void 0,void 0,(function*(){const t=(0,n.compressToUTF16)(JSON.stringify(e)),o=[];for(let e=0;e<t.length;e+=c)o.push(t.slice(e,e+c));return t.length>l?[o,`Warning: Template "${e.name}" is ${(t.length/1024).toFixed(2)}KB, which is approaching the storage limit.`]:[o,null]}))}function v(){return{id:Date.now().toString()+Math.random().toString(36).slice(2,11),name:"Default",behavior:"create",noteNameFormat:"{{title}}",path:"Clippings",noteContentFormat:"{{content}}",properties:[{id:Date.now().toString()+Math.random().toString(36).slice(2,11),name:"title",value:"{{title}}",type:"text"},{id:Date.now().toString()+Math.random().toString(36).slice(2,11),name:"source",value:"{{url}}",type:"text"},{id:Date.now().toString()+Math.random().toString(36).slice(2,11),name:"author",value:"{{author|wikilink}}",type:"text"},{id:Date.now().toString()+Math.random().toString(36).slice(2,11),name:"published",value:"{{published}}",type:"date"},{id:Date.now().toString()+Math.random().toString(36).slice(2,11),name:"created",value:"{{date}}",type:"date"},{id:Date.now().toString()+Math.random().toString(36).slice(2,11),name:"description",value:"{{description}}",type:"text"},{id:Date.now().toString()+Math.random().toString(36).slice(2,11),name:"tags",value:"clippings",type:"multitext"}],triggers:[]}}function f(){return a}function h(){return r}const g={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},y=(e,t,n=[])=>{const o=document.createElementNS("http://www.w3.org/2000/svg",e);return Object.keys(t).forEach((e=>{o.setAttribute(e,String(t[e]))})),n.length&&n.forEach((e=>{const t=y(...e);o.appendChild(t)})),o},E=e=>"string"==typeof e?e:e&&e.class?e.class&&"string"==typeof e.class?e.class.split(" "):e.class&&Array.isArray(e.class)?e.class:"":"",b=(e,{nameAttr:t,icons:n,attrs:o})=>{const r=e.getAttribute(t);if(null==r)return;const a=n[r.replace(/(\w)(\w*)(_|-|\s*)/g,((e,t,n)=>t.toUpperCase()+n.toLowerCase()))];if(!a)return console.warn(`${e.outerHTML} icon name was not found in the provided icons object.`);const i=(e=>Array.from(e.attributes).reduce(((e,t)=>(e[t.name]=t.value,e)),{}))(e),[s,c,l]=a,d={...c,"data-lucide":r,...o,...i},u=["lucide",`lucide-${r}`,i,o].flatMap(E).map((e=>e.trim())).filter(Boolean).filter(((e,t,n)=>n.indexOf(e)===t)).join(" ");u&&Object.assign(d,{class:u});const p=(([e,t,n])=>y(e,t,n))([s,d,l]);return e.parentNode?.replaceChild(p,e)},w=({icons:e={},nameAttr:t="data-lucide",attrs:n={}}={})=>{if(!Object.values(e).length)throw new Error("Please provide an icons object.\nIf you want to use all the icons you can import it like:\n `import { createIcons, icons } from 'lucide';\nlucide.createIcons({icons});`");if("undefined"==typeof document)throw new Error("`createIcons()` only works in a browser environment.");const o=document.querySelectorAll(`[${t}]`);if(Array.from(o).forEach((o=>b(o,{nameAttr:t,icons:e,attrs:n}))),"data-lucide"===t){const t=document.querySelectorAll("[icon-name]");t.length>0&&(console.warn("[Lucide] Some icons were found with the now deprecated icon-name attribute. These will still be replaced for backwards compatibility, but will no longer be supported in v1.0 and you should switch to data-lucide"),Array.from(t).forEach((t=>b(t,{nameAttr:"icon-name",icons:e,attrs:n}))))}},x={Trash2:["svg",g,[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]]],AlignLeft:["svg",g,[["line",{x1:"21",x2:"3",y1:"6",y2:"6"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18"}]]],Binary:["svg",g,[["rect",{x:"14",y:"14",width:"4",height:"6",rx:"2"}],["rect",{x:"6",y:"4",width:"4",height:"6",rx:"2"}],["path",{d:"M6 20h4"}],["path",{d:"M14 10h4"}],["path",{d:"M6 14h2v6"}],["path",{d:"M14 4h2v6"}]]],List:["svg",g,[["line",{x1:"8",x2:"21",y1:"6",y2:"6"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18"}]]],Calendar:["svg",g,[["path",{d:"M8 2v4"}],["path",{d:"M16 2v4"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2"}],["path",{d:"M3 10h18"}]]],Clock:["svg",g,[["circle",{cx:"12",cy:"12",r:"10"}],["polyline",{points:"12 6 12 12 16 14"}]]],Ellipsis:["svg",g,[["circle",{cx:"12",cy:"12",r:"1"}],["circle",{cx:"19",cy:"12",r:"1"}],["circle",{cx:"5",cy:"12",r:"1"}]]],SquareCheckBig:["svg",g,[["path",{d:"m9 11 3 3L22 4"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"}]]],GripVertical:["svg",g,[["circle",{cx:"9",cy:"12",r:"1"}],["circle",{cx:"9",cy:"5",r:"1"}],["circle",{cx:"9",cy:"19",r:"1"}],["circle",{cx:"15",cy:"12",r:"1"}],["circle",{cx:"15",cy:"5",r:"1"}],["circle",{cx:"15",cy:"19",r:"1"}]]],Settings:["svg",g,[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]]],X:["svg",g,[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]]],ChevronRight:["svg",g,[["path",{d:"m9 18 6-6-6-6"}]]],ChevronDown:["svg",g,[["path",{d:"m6 9 6 6 6-6"}]]]};function L(e=document){w({icons:x,attrs:{"stroke-width":1.75,class:"lucide-icon"},nameAttr:"data-lucide"})}function A(e){return{text:"align-left",multitext:"list",number:"binary",checkbox:"square-check-big",date:"calendar",datetime:"clock"}[e]||"align-left"}var B=function(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{c(o.next(e))}catch(e){a(e)}}function s(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((o=o.apply(e,t||[])).next())}))};let I={showMoreActionsButton:!0,vaults:[]};function S(e){return B(this,void 0,void 0,(function*(){I=Object.assign(Object.assign({},I),e),yield chrome.storage.sync.set({general_settings:{showMoreActionsButton:I.showMoreActionsButton},vaults:I.vaults})}))}function k(e,t){let n=`${window.location.pathname}?section=${e}`;t&&(n+=`&template=${t}`),window.history.pushState({},"",n)}function M(e,t){t.checked?e.classList.add("is-enabled"):e.classList.remove("is-enabled")}function C(){const e=document.getElementById("vault-list");e&&(e.innerHTML="",I.vaults.forEach(((t,n)=>{const o=document.createElement("li");o.innerHTML=`\n\t\t\t<div class="drag-handle">\n\t\t\t\t<i data-lucide="grip-vertical"></i>\n\t\t\t</div>\n\t\t\t<span>${t}</span>\n\t\t\t<button type="button" class="remove-vault-btn clickable-icon" aria-label="Remove vault">\n\t\t\t\t<i data-lucide="trash-2"></i>\n\t\t\t</button>\n\t\t`,o.dataset.index=n.toString(),o.draggable=!0,o.addEventListener("dragstart",O),o.addEventListener("dragover",P),o.addEventListener("drop",F),o.addEventListener("dragend",j),o.querySelector(".remove-vault-btn").addEventListener("click",(e=>{e.stopPropagation(),function(e){I.vaults.splice(e,1),S(),C()}(n)})),e.appendChild(o)})),L(e))}function T(){(function(){return B(this,void 0,void 0,(function*(){var e,t;const n=yield chrome.storage.sync.get(["general_settings","vaults"]);return I={showMoreActionsButton:null===(t=null===(e=n.general_settings)||void 0===e?void 0:e.showMoreActionsButton)||void 0===t||t,vaults:n.vaults||[]},I}))})().then((()=>{C(),function(){const e=document.getElementById("show-more-actions-toggle");e&&(e.checked=I.showMoreActionsButton,e.addEventListener("change",(()=>{S({showMoreActionsButton:e.checked})})))}(),function(){const e=document.getElementById("vault-input");e&&e.addEventListener("keypress",(t=>{if("Enter"===t.key){t.preventDefault();const o=e.value.trim();o&&(n=o,I.vaults.push(n),S(),C(),e.value="")}var n}))}(),function(){const e=document.getElementById("keyboard-shortcuts-list");e&&function(){return e=this,t=void 0,o=function*(){return new Promise((e=>{chrome.commands.getAll((t=>{e(t.map((e=>({name:e.name||"",description:e.description||"Open clipper",shortcut:e.shortcut||null}))))}))}))},new((n=void 0)||(n=Promise))((function(r,a){function i(e){try{c(o.next(e))}catch(e){a(e)}}function s(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((o=o.apply(e,t||[])).next())}));var e,t,n,o}().then((t=>{t.forEach((t=>{const n=document.createElement("div");n.className="shortcut-item",n.innerHTML=`\n\t\t\t\t<span>${t.description}</span>\n\t\t\t\t<span class="setting-hotkey">${t.shortcut||"Not set"}</span>\n\t\t\t`,e.appendChild(n)}))}))}(),document.querySelectorAll(".checkbox-container").forEach((e=>{const t=e.querySelector('input[type="checkbox"]');t&&(M(e,t),t.addEventListener("change",(()=>{M(e,t)})),e.addEventListener("click",(e=>{e.preventDefault(),t.checked=!t.checked,t.dispatchEvent(new Event("change"))})))}))}))}let D=null;function O(e){e.stopPropagation(),D=e.target.closest("[draggable]"),D&&e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",D.dataset.id||D.dataset.index||""),setTimeout((()=>{D&&D.classList.add("dragging")}),0))}function P(e){var t,n;e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="move");const o=e.target.closest("[draggable]");if(o&&o!==D&&D){const r=o.getBoundingClientRect(),a=r.top+r.height/2;e.clientY<a?null===(t=o.parentNode)||void 0===t||t.insertBefore(D,o):null===(n=o.parentNode)||void 0===n||n.insertBefore(D,o.nextSibling)}}function F(e){if(e.stopPropagation(),e.preventDefault(),!e.dataTransfer)return;const t=e.dataTransfer.getData("text/plain"),n=e.target.closest("ul, #template-properties");if(n&&D){const e=Array.from(n.children).indexOf(D);"template-list"===n.id?function(e,t){const n=h(),o=n.findIndex((t=>t.id===e));if(-1!==o&&o!==t){const[e]=n.splice(o,1);n.splice(t,0,e),p().then((()=>{N()})).catch((e=>{console.error("Failed to save template settings:",e)}))}}(t,e):"template-properties"===n.id?function(e,t){const n=f();if(-1===n)return void console.error("No template is currently being edited");const o=h()[n];if(!o)return void console.error("Template not found");if(!Array.isArray(o.properties)||0===o.properties.length)return void console.error("Template properties array is empty or not an array");const r=o.properties.findIndex((t=>t.id===e));if(-1!==r){if(r!==t){const[e]=o.properties.splice(r,1);o.properties.splice(t,0,e),p().then((()=>{N()})).catch((e=>{console.error("Failed to save template settings:",e)}))}}else console.error("Property not found")}(t,e):"vault-list"===n.id&&function(e){if(!D)return;const t=parseInt(D.dataset.index||"-1");if(-1!==t&&t!==e){const[n]=I.vaults.splice(t,1);I.vaults.splice(e,0,n),S(),C()}}(e),D.classList.remove("dragging")}D=null}function j(){D&&D.classList.remove("dragging"),D=null}let $=!1;function q(){$=!1}function N(e){const t=document.getElementById("template-list");if(!t)return void console.error("Template list element not found");const n=e||r;t.innerHTML="",n.forEach(((e,n)=>{if(e&&e.name&&e.id){const o=document.createElement("li");o.innerHTML=`\n\t\t\t\t<div class="drag-handle">\n\t\t\t\t\t<i data-lucide="grip-vertical"></i>\n\t\t\t\t</div>\n\t\t\t\t<span class="template-name">${e.name}</span>\n\t\t\t\t<button type="button" class="delete-template-btn clickable-icon" aria-label="Delete template">\n\t\t\t\t\t<i data-lucide="trash-2"></i>\n\t\t\t\t</button>\n\t\t\t`,o.dataset.id=e.id,o.dataset.index=n.toString(),o.draggable=!0,o.addEventListener("click",(t=>{t.target.closest(".delete-template-btn")||U(e)}));const i=o.querySelector(".delete-template-btn");i&&i.addEventListener("click",(t=>{t.stopPropagation(),function(e){const t=r.findIndex((t=>t.id===e));if(-1!==t&&confirm(`Are you sure you want to delete the template "${r[t].name}"?`)){if(r.splice(t,1),a===t)if(r.length>0){const e=Math.max(0,t-1);U(r[e])}else!function(){d(-1);const e=document.getElementById("template-editor-title"),t=document.getElementById("template-name"),n=document.getElementById("template-properties");e&&(e.textContent="New template"),t&&(t.value=""),n&&(n.innerHTML="");const o=document.getElementById("template-path-name");o&&(o.value="Clippings");const r=document.getElementById("url-patterns");r&&(r.value="");const a=document.getElementById("template-editor");a&&(a.style.display="none")}();else a>t&&d(a-1);p(),N()}}(e.id)})),n===a&&o.classList.add("active"),t.appendChild(o)}else console.error("Invalid template at index",n,":",e)})),L(t)}function U(e){let t;e?(t=e,d(r.findIndex((e=>e.id===t.id)))):(t={id:Date.now().toString()+Math.random().toString(36).slice(2,11),name:"New template",behavior:"create",noteNameFormat:"{{title}}",path:"Clippings",noteContentFormat:"{{content}}",properties:[],triggers:[]},r.push(t),d(r.length-1),p().then((()=>{N()})).catch((e=>{console.error("Failed to save new template:",e)}))),t.properties||(t.properties=[]);const n=document.getElementById("template-editor-title"),o=document.getElementById("template-name"),i=document.getElementById("template-properties");n&&(n.textContent="Edit template"),o&&(o.value=t.name),i&&(i.innerHTML="");const s=document.getElementById("template-path-name");s&&(s.value=t.path);const c=document.getElementById("template-behavior");c&&(c.value=t.behavior||"create");const l=document.getElementById("specific-note-name");l&&(l.value=t.specificNoteName||"");const u=document.getElementById("daily-note-format");u&&(u.value=t.dailyNoteFormat||"YYYY-MM-DD");const m=document.getElementById("note-name-format");m&&(m.value=t.noteNameFormat||"{{title}}");const v=document.getElementById("note-content-format");v&&(v.value=t.noteContentFormat||""),_(),c&&c.addEventListener("change",_),t&&Array.isArray(t.properties)&&t.properties.forEach((e=>H(e.name,e.value,e.type,e.id)));const f=document.getElementById("url-patterns");f&&(f.value=t&&t.triggers?t.triggers.join("\n"):"");const h=document.getElementById("template-editor");h&&(h.style.display="block");const g=document.getElementById("templates-section");g&&(g.style.display="block");const y=document.getElementById("general-section");if(y&&(y.style.display="none"),document.querySelectorAll(".sidebar li[data-section]").forEach((e=>e.classList.remove("active"))),document.querySelectorAll("#template-list li").forEach((e=>e.classList.remove("active"))),-1!==a){const e=document.querySelector(`#template-list li[data-id="${r[a].id}"]`);e&&e.classList.add("active")}if(g&&g.classList.add("active"),y&&y.classList.remove("active"),N(),!t.id){const e=document.getElementById("template-name");e&&(e.focus(),e.select())}q(),o&&o.addEventListener("input",(()=>{-1!==a&&r[a]&&(r[a].name=o.value,N())}));const E=document.getElementById("template-vault");E&&(E.innerHTML='<option value="">Last used</option>',I.vaults.forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e,E.appendChild(t)})),E.value=t.vault||""),k("templates",t.id)}function _(){const e=document.getElementById("template-behavior"),t=document.getElementById("specific-note-container"),n=document.getElementById("daily-note-format-container"),o=document.getElementById("note-name-format-container"),r=document.getElementById("properties-container"),a=document.getElementById("properties-warning");if(e){const i=e.value;t&&(t.style.display="append-specific"===i?"block":"none"),n&&(n.style.display="append-daily"===i?"block":"none"),o&&(o.style.display="create"===i?"block":"none"),"append-specific"===i||"append-daily"===i?(r&&(r.style.display="none"),a&&(a.style.display="block")):(r&&(r.style.display="block"),a&&(a.style.display="none"))}}function H(e="",t="",n="text",o=null){const r=document.getElementById("template-properties");if(!r)return;const a=o||Date.now().toString()+Math.random().toString(36).slice(2,11),i=document.createElement("div");var s;i.className="property-editor",i.innerHTML=`\n\t\t<div class="drag-handle">\n\t\t\t<i data-lucide="grip-vertical"></i>\n\t\t</div>\n\t\t<div class="property-select">\n\t\t\t<div class="property-selected" data-value="${n}">\n\t\t\t\t<i data-lucide="${A(n)}"></i>\n\t\t\t</div>\n\t\t\t<select class="property-type" id="${a}-type">\n\t\t\t\t<option value="text">Text</option>\n\t\t\t\t<option value="multitext">List</option>\n\t\t\t\t<option value="number">Number</option>\n\t\t\t\t<option value="checkbox">Checkbox</option>\n\t\t\t\t<option value="date">Date</option>\n\t\t\t\t<option value="datetime">Date & time</option>\n\t\t\t</select>\n\t\t</div>\n\t\t<input type="text" class="property-name" id="${a}-name" value="${e}" placeholder="Property name">\n\t\t<input type="text" class="property-value" id="${a}-value" value="${s=function(e){return e.replace(/\\"/g,'"').replace(/\\n/g,"\n")}(t),s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}" placeholder="Property value">\n\t\t<button type="button" class="remove-property-btn clickable-icon" aria-label="Remove property">\n\t\t\t<i data-lucide="trash-2"></i>\n\t\t</button>\n\t`,i.dataset.id=a,r.appendChild(i),i.addEventListener("mousedown",(e=>{e.target.closest("input, select, button")||(i.setAttribute("draggable","true"),r.querySelectorAll(".property-editor").forEach((e=>{e!==i&&e.setAttribute("draggable","true")})))}));const c=()=>{i.removeAttribute("draggable"),r.querySelectorAll(".property-editor").forEach((e=>{e.removeAttribute("draggable")}))};i.addEventListener("dragend",c),i.addEventListener("mouseup",c);const l=i.querySelector(".property-select");if(!l)return;const d=l.querySelector(".property-selected"),u=l.querySelector("select");u&&(u.value=n,u.addEventListener("change",(function(){d&&R(this.value,d)})));const p=i.querySelector(".remove-property-btn");p&&p.addEventListener("click",(()=>{r.removeChild(i)})),i.addEventListener("dragstart",O),i.addEventListener("dragover",P),i.addEventListener("drop",F),i.addEventListener("dragend",j),d&&R(n,d),L(i)}function R(e,t){const n=A(e);t.innerHTML=`<i data-lucide="${n}"></i>`,t.setAttribute("data-value",e),L(t)}function V(){if(-1===a)return;const e=r[a];if(!e)return void console.error("Template not found");const t=document.getElementById("template-behavior");t&&(e.behavior=t.value);const n=document.getElementById("template-path-name");n&&(e.path=n.value);const o=document.getElementById("note-name-format");o&&(e.noteNameFormat=o.value);const i=document.getElementById("specific-note-name");i&&(e.specificNoteName=i.value);const s=document.getElementById("daily-note-format");s&&(e.dailyNoteFormat=s.value);const c=document.getElementById("note-content-format");c&&(e.noteContentFormat=c.value);const l=document.querySelectorAll("#template-properties .property-editor");e.properties=Array.from(l).map((e=>{const t=e.querySelector(".property-name"),n=e.querySelector(".property-value"),o=e.querySelector(".property-select .property-selected");return{id:e.dataset.id||Date.now().toString()+Math.random().toString(36).slice(2,11),name:t.value,value:(r=n.value,r.replace(/"/g,'\\"').replace(/\n/g,"\\n")),type:o.getAttribute("data-value")||"text"};var r}));const d=document.getElementById("url-patterns");d&&(e.triggers=d.value.split("\n").filter(Boolean));const u=document.getElementById("template-vault");u&&(e.vault=u.value||void 0),$=!0}function J(){H(),-1!==a&&V()}function Y(){const e=document.getElementById("template-settings-form");if(!e)return void console.error("Template form not found");const t=(e=>{let t=null;return function(...n){const o=this;t&&clearTimeout(t),t=setTimeout((()=>e.apply(o,n)),1e3)}})((()=>{return e=this,t=void 0,o=function*(){try{const e=yield p();e.length>0&&(N(),console.log("Auto-save completed"),function(e){console.warn(e.join("\n"))}(e))}catch(e){console.error("Auto-save failed:",e)}},new((n=void 0)||(n=Promise))((function(r,a){function i(e){try{c(o.next(e))}catch(e){a(e)}}function s(e){try{c(o.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((o=o.apply(e,t||[])).next())}));var e,t,n,o}));e.addEventListener("input",(()=>{-1!==a&&(V(),t())}));const n=document.getElementById("template-properties");n&&(n.addEventListener("click",(e=>{const n=e.target;(n.classList.contains("remove-property-btn")||n.closest(".remove-property-btn"))&&-1!==a&&(V(),t())})),n.addEventListener("change",(e=>{e.target.classList.contains("property-type")&&-1!==a&&(V(),t())})))}function z(){if(-1===a)return void alert("Please select a template to export.");const e=r[a],t=`${n=e.name,n.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[\s_]+/g,"-").toLowerCase()}-clipper.json`;var n;const o={schemaVersion:"0.1.0",name:e.name,behavior:e.behavior,noteNameFormat:e.noteNameFormat,path:e.path,noteContentFormat:e.noteContentFormat,properties:e.properties.map((({name:e,value:t,type:n})=>({name:e,value:t,type:n}))),triggers:e.triggers},i=JSON.stringify(o,null,2),s=new Blob([i],{type:"application/json"}),c=URL.createObjectURL(s),l=document.createElement("a");l.href=c,l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(c)}function G(){const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=e=>{var t;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!n)return;const o=new FileReader;o.onload=e=>{var t,n;try{const o=JSON.parse(null===(t=e.target)||void 0===t?void 0:t.result);if(!K(o))throw new Error("Invalid template file");o.id=Date.now().toString()+Math.random().toString(36).substr(2,9),o.properties=null===(n=o.properties)||void 0===n?void 0:n.map((e=>Object.assign(Object.assign({},e),{id:Date.now().toString()+Math.random().toString(36).substr(2,9)})));let a=o.name,i=1;for(;r.some((e=>e.name===a));)a=`${o.name} (${i++})`;o.name=a,r.push(o),p(),N(),U(o)}catch(e){console.error("Error parsing imported template:",e),alert("Error importing template. Please check the file and try again.")}},o.readAsText(n)},e.click()}function K(e){const t=["text","multitext","number","checkbox","date","datetime"];return["name","behavior","path","properties","noteContentFormat"].every((t=>e.hasOwnProperty(t)))&&Array.isArray(e.properties)&&e.properties.every((e=>e.hasOwnProperty("name")&&e.hasOwnProperty("value")&&e.hasOwnProperty("type")&&t.includes(e.type)))}function W(e){const t=new FileReader;t.onload=e=>{var t,n;try{const o=JSON.parse(null===(t=e.target)||void 0===t?void 0:t.result);if(!K(o))throw new Error("Invalid template file");o.id=Date.now().toString()+Math.random().toString(36).substr(2,9),o.properties=null===(n=o.properties)||void 0===n?void 0:n.map((e=>Object.assign(Object.assign({},e),{id:Date.now().toString()+Math.random().toString(36).substr(2,9)})));let a=o.name,i=1;for(;r.some((e=>e.name===a));)a=`${o.name} (${i++})`;o.name=a,r.push(o),p(),N(),U(o)}catch(e){console.error("Error parsing imported template:",e),alert("Error importing template. Please check the file and try again.")}},t.readAsText(e)}function X(){const e=document.getElementById("general-section"),t=document.getElementById("templates-section");e&&(e.style.display="block",e.classList.add("active")),t&&(t.style.display="none",t.classList.remove("active")),k("general"),document.querySelectorAll(".sidebar li").forEach((e=>e.classList.remove("active")));const n=document.querySelector('.sidebar li[data-section="general"]');n&&n.classList.add("active")}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("new-template-btn"),t=document.getElementById("export-template-btn"),n=document.getElementById("import-template-btn"),a=document.getElementById("reset-default-template-btn");document.getElementById("template-settings-form")&&(Y(),[document.getElementById("template-list"),document.getElementById("template-properties"),document.getElementById("vault-list")].forEach((e=>{e&&(e.addEventListener("dragstart",O),e.addEventListener("dragover",P),e.addEventListener("drop",F),e.addEventListener("dragend",j))})),function(){const e=document.getElementById("template-drop-zone"),t=document.body;if(!e)return void console.error("Drop zone not found");let n=0;function o(e){var t;if(null===(t=e.dataTransfer)||void 0===t?void 0:t.types)for(let t=0;t<e.dataTransfer.types.length;t++)if("Files"===e.dataTransfer.types[t])return!0;return!1}t.addEventListener("dragenter",(function(t){t.preventDefault(),t.stopPropagation(),n++,o(t)&&(null==e||e.classList.add("drag-over"))}),!1),t.addEventListener("dragleave",(function(t){t.preventDefault(),t.stopPropagation(),n--,0===n&&(null==e||e.classList.remove("drag-over"))}),!1),t.addEventListener("dragover",(function(e){e.preventDefault(),e.stopPropagation()}),!1),t.addEventListener("drop",(function(t){var r;if(t.preventDefault(),t.stopPropagation(),null==e||e.classList.remove("drag-over"),n=0,o(t)){const e=null===(r=t.dataTransfer)||void 0===r?void 0:r.files;e&&e.length&&function(e){Array.from(e).forEach(W)}(e)}}),!1)}(),function(){const e=document.getElementById("add-property-btn");e?(e.removeEventListener("click",J),e.addEventListener("click",J)):console.error("Add property button not found")}()),T(),function(){return new Promise((e=>{chrome.storage.sync.get(s,(t=>o(this,void 0,void 0,(function*(){const n=t[s]||[],o=[];for(const e of n){const t=yield u(e);t&&o.push(t)}if(0===o.length){const e=v();o.push(e),yield p()}r=o,e(r)}))))}))}().then((t=>{N(t),function(){const t=document.getElementById("template-list");t?t.addEventListener("click",(e=>{const t=e.target.closest("li");if(t&&t.dataset.id){const e=h().find((e=>e.id===t.dataset.id));e&&(q(),U(e),k("templates",e.id))}})):console.error("Template list not found"),e&&e.addEventListener("click",(()=>{U(null)}))}(),function(){const e=new URLSearchParams(window.location.search),t=e.get("section"),n=e.get("template");if("general"===t)X();else if(n){const e=(o=n,r.find((e=>e.id===o)));e?U(e):(console.error(`Template with id ${n} not found`),X())}else X();var o}()})),function(){const e=document.querySelectorAll(".sidebar li[data-section]"),t=document.querySelectorAll(".settings-section"),n=document.querySelector(".sidebar");n&&n.addEventListener("click",(e=>{"general"===e.target.dataset.section&&X()})),e.forEach((n=>{n.addEventListener("click",(()=>{const o=n.dataset.section;e.forEach((e=>e.classList.remove("active"))),n.classList.add("active"),document.querySelectorAll("#template-list li").forEach((e=>e.classList.remove("active")));const r=document.getElementById("template-editor");r&&(r.style.display="none"),t.forEach((e=>{e.id===`${o}-section`?(e.style.display="block",e.classList.add("active")):(e.style.display="none",e.classList.remove("active"))}))}))}))}(),Y(),t.addEventListener("click",z),n.addEventListener("click",G),a.addEventListener("click",(function(){const e=v(),t=h(),n=t.findIndex((e=>"Default"===e.name));-1!==n?t[n]=e:t.unshift(e),p().then((()=>{N(),U(e)})).catch((e=>{console.error("Failed to reset default template:",e),alert("Failed to reset default template. Please try again.")}))})),w({icons:x})}));